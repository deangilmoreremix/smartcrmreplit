import{r as l,dl as T,dq as M,aO as _,j as e,bM as S,b as A,aa as j,ab as g,ac as v,cV as D,cc as N,ad as f,d as O,a6 as h,b5 as B,dr as L,aM as $}from"./index-e3V0CD7Y.js";import{T as q}from"./textarea-Dn_UEKqi.js";function Y(){const[d,b]=l.useState(""),[i,y]=l.useState([]),[r,w]=l.useState(null),[o,m]=l.useState(!1),[n,x]=l.useState("upload"),[k,I]=l.useState(!1),{toast:a}=T(),{user:c}=M(),p=_(),U=["dean@videoremix.io","samuel@videoremix.io","victor@videoremix.io"];if(l.useEffect(()=>{(()=>{if(!c?.email){a({title:"Access Denied",description:"You must be logged in to access this page",variant:"destructive"}),p("/dashboard");return}const t=c.email.toLowerCase();if(!(U.includes(t)||c.role==="admin"||c.role==="super_admin")){a({title:"Admin Access Required",description:"This page is restricted to system administrators only",variant:"destructive"}),p("/dashboard");return}I(!0)})()},[c,p,a]),!k)return e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Verifying Admin Access..."}),e.jsx("p",{className:"text-gray-500",children:"Please wait while we verify your permissions."})]})})});const E=`email,first_name,last_name,company,phone,role
john.doe@company.com,John,Doe,Acme Corp,(555) 123-4567,Manager
jane.smith@business.com,Jane,Smith,Tech Solutions,(555) 987-6543,Director`,P=async()=>{if(!d.trim()){a({title:"Error",description:"Please paste your CSV data first",variant:"destructive"});return}m(!0);try{const s=await fetch("/api/bulk-import/parse-csv",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csv_content:d})}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to parse CSV");y(t.users),x("preview"),a({title:"Success",description:`Parsed ${t.users.length} users from CSV`})}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}finally{m(!1)}},V=async()=>{if(i.length){m(!0);try{const s=await fetch("/api/bulk-import/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:i,send_notifications:!0})}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to import users");w(t.result),x("complete"),a({title:"Import Complete",description:`Successfully imported ${t.result.success} users`})}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}finally{m(!1)}}},R=()=>{b(""),y([]),w(null),x("upload")};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(S,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin: Bulk User Import"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full",children:"ADMIN ONLY"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Logged in as: ",c?.email]})]})]})]}),e.jsx("p",{className:"text-gray-600",children:"Import users for SmartCRM. All users get access to the complete suite of apps and features."})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:["Upload CSV","Preview Users","Import Users","Complete"].map((s,t)=>{const u=["upload","preview","import","complete"][t]===n,C=["upload","preview","import","complete"].indexOf(n)>t;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${C?"bg-green-500 text-white":u?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"}`,children:C?e.jsx(A,{className:"w-5 h-5"}):t+1}),e.jsx("span",{className:`ml-2 text-sm ${u?"text-blue-600":"text-gray-600"}`,children:s}),t<3&&e.jsx("div",{className:"w-12 h-0.5 bg-gray-300 mx-4"})]},s)})})}),n==="upload"&&e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Upload CSV Data"]}),e.jsx(N,{children:"Paste your CSV data below. Required columns: email, first_name, last_name"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(O,{className:"h-4 w-4 text-blue-600 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-blue-800",children:"CSV Format Example:"}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border",children:E})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV Data"}),e.jsx(q,{placeholder:"Paste your CSV data here...",value:d,onChange:s=>b(s.target.value),className:"min-h-40"})]}),e.jsx(h,{onClick:P,disabled:o||!d.trim(),className:"w-full",children:o?"Parsing...":"Parse CSV"})]})]}),n==="preview"&&e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Preview Users (",i.length,")"]}),e.jsx(N,{children:"Review the parsed users before importing"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"max-h-60 overflow-y-auto border rounded p-4",children:[i.slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-600",children:s.email}),s.company&&e.jsx("div",{className:"text-xs text-gray-500",children:s.company})]}),e.jsx("div",{className:"text-sm text-blue-600",children:"SmartCRM"})]},t)),i.length>10&&e.jsxs("div",{className:"text-center text-gray-500 py-2",children:["... and ",i.length-10," more users"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(h,{variant:"outline",onClick:()=>x("upload"),children:"Back to Upload"}),e.jsx(h,{onClick:V,disabled:o,className:"flex-1",children:o?"Importing...":`Import ${i.length} Users`})]})]})]}),n==="complete"&&r&&e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-green-600"}),"Import Complete"]}),e.jsx(N,{children:"Your bulk user import has been completed"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.failed}),e.jsx("div",{className:"text-sm text-red-700",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.success}),e.jsx("div",{className:"text-sm text-blue-700",children:"Emails Sent"})]})]}),r.errors.length>0&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(L,{className:"h-4 w-4 text-red-600 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-800",children:"Import Errors:"}),e.jsxs("ul",{className:"mt-2 space-y-1",children:[r.errors.slice(0,5).map((s,t)=>e.jsxs("li",{className:"text-sm text-red-700",children:["• ",s]},t)),r.errors.length>5&&e.jsxs("li",{className:"text-sm text-red-700",children:["... and ",r.errors.length-5," more errors"]})]})]})]})}),e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx($,{className:"h-4 w-4 text-green-600 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-green-800",children:"What happens next:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-green-700",children:[e.jsx("li",{children:"• Users receive welcome emails with account access links"}),e.jsx("li",{children:'• Emails use the "Confirm Reauthentication" template with SmartCRM branding'}),e.jsx("li",{children:"• Users set their password and access their dashboard immediately"}),e.jsx("li",{children:"• All support requests go to support@videoremix.io"})]})]})]})}),e.jsx(h,{onClick:R,className:"w-full",children:"Import More Users"})]})]})]})}export{Y as default};
