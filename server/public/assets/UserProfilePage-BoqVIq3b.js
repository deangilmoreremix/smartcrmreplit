import{cB as H,dl as Q,r as p,cF as m,j as e,af as W,ag as Z,ah as P,ai as C,aa as j,ab as g,ac as v,U as D,cc as w,ad as N,b0 as K,a6 as f,aV as X,bM as ee,aJ as k,aI as A,b as ae,ba as se,a9 as re,bc as te,ct as T,cu as ie}from"./index-e3V0CD7Y.js";import{I as n}from"./input-CBb2iGdE.js";import{L as i}from"./label-D929QgCh.js";import{T as le}from"./textarea-Dn_UEKqi.js";import{S as M,a as B,b as I,c as R,d as o}from"./select-D9Wy1FBy.js";function he(){const{user:y}=H(),{toast:l}=Q(),[u,c]=p.useState(!1),[_,U]=p.useState(!1),[r,t]=p.useState({id:"",username:"",firstName:"",lastName:"",email:"",phone:"",avatar:"",role:"regular_user",appContext:"smartcrm",bio:"",company:"",position:"",location:"",website:"",timezone:"America/New_York",language:"en",emailNotifications:!0,pushNotifications:!0,marketingEmails:!1,twoFactorEnabled:!1}),[h,b]=p.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[x,E]=p.useState({current:!1,new:!1,confirm:!1});p.useEffect(()=>{y&&Y()},[y]);const Y=async()=>{try{c(!0);const{data:a,error:s}=await m.from("profiles").select("*").eq("id",y?.id).single();if(s&&s.code!=="PGRST116")throw s;const{data:{user:d},error:S}=await m.auth.getUser();if(S)throw S;t({id:y?.id||"",username:a?.username||d?.email?.split("@")[0]||"",firstName:a?.firstName||d?.user_metadata?.first_name||"",lastName:a?.lastName||d?.user_metadata?.last_name||"",email:d?.email||"",phone:d?.phone||d?.user_metadata?.phone||"",avatar:a?.avatar||d?.user_metadata?.avatar_url||"",role:a?.role||"regular_user",appContext:a?.appContext||"smartcrm",bio:a?.bio||"",company:a?.company||"",position:a?.position||"",location:a?.location||"",website:a?.website||"",timezone:a?.timezone||"America/New_York",language:a?.language||"en",emailNotifications:a?.emailNotifications??!0,pushNotifications:a?.pushNotifications??!0,marketingEmails:a?.marketingEmails??!1,twoFactorEnabled:d?.factors?.length>0||!1})}catch(a){console.error("Error loading profile:",a),l({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{c(!1)}},F=async()=>{try{c(!0);const{error:a}=await m.from("profiles").upsert({id:r.id,username:r.username,firstName:r.firstName,lastName:r.lastName,avatar:r.avatar,bio:r.bio,company:r.company,position:r.position,location:r.location,website:r.website,timezone:r.timezone,language:r.language,emailNotifications:r.emailNotifications,pushNotifications:r.pushNotifications,marketingEmails:r.marketingEmails,updatedAt:new Date().toISOString()});if(a)throw a;const{error:s}=await m.auth.updateUser({data:{first_name:r.firstName,last_name:r.lastName,phone:r.phone,avatar_url:r.avatar,company:r.company,position:r.position}});if(s)throw s;l({title:"Success",description:"Profile updated successfully"})}catch(a){console.error("Error updating profile:",a),l({title:"Error",description:a.message||"Failed to update profile",variant:"destructive"})}finally{c(!1)}},V=async()=>{try{if(h.newPassword!==h.confirmPassword){l({title:"Error",description:"New passwords do not match",variant:"destructive"});return}if(h.newPassword.length<8){l({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}c(!0);const{error:a}=await m.auth.updateUser({password:h.newPassword});if(a)throw a;b({currentPassword:"",newPassword:"",confirmPassword:""}),l({title:"Success",description:"Password updated successfully"})}catch(a){console.error("Error updating password:",a),l({title:"Error",description:a.message||"Failed to update password",variant:"destructive"})}finally{c(!1)}},$=async a=>{try{const s=a.target.files?.[0];if(!s)return;if(s.size>2*1024*1024){l({title:"Error",description:"File size must be less than 2MB",variant:"destructive"});return}U(!0);const d=s.name.split(".").pop(),z=`avatars/${`${r.id}.${d}`}`,{error:L}=await m.storage.from("avatars").upload(z,s,{upsert:!0});if(L)throw L;const{data:{publicUrl:q}}=m.storage.from("avatars").getPublicUrl(z);t(J=>({...J,avatar:q})),l({title:"Success",description:"Avatar uploaded successfully"})}catch(s){console.error("Error uploading avatar:",s),l({title:"Error",description:s.message||"Failed to upload avatar",variant:"destructive"})}finally{U(!1)}},G=async()=>{try{c(!0);const{data:a,error:s}=await m.auth.mfa.enroll({factorType:"totp"});if(s)throw s;l({title:"Two-Factor Authentication",description:"Scan the QR code with your authenticator app"}),console.log("2FA setup data:",a)}catch(a){console.error("Error enabling 2FA:",a),l({title:"Error",description:a.message||"Failed to enable two-factor authentication",variant:"destructive"})}finally{c(!1)}},O=async()=>{try{if(!confirm("Are you sure you want to delete your account? This action cannot be undone."))return;c(!0);const{error:a}=await m.from("profiles").delete().eq("id",r.id);if(a)throw a;await m.auth.signOut(),l({title:"Account Deleted",description:"Your account has been successfully deleted"})}catch(a){console.error("Error deleting account:",a),l({title:"Error",description:a.message||"Failed to delete account",variant:"destructive"})}finally{c(!1)}};return u&&!r.id?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading profile..."})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Account Settings"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Manage your profile and account preferences"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.role==="super_admin"?"bg-purple-100 text-purple-800":r.role==="wl_user"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:r.role.replace("_"," ").toUpperCase()})})]}),e.jsxs(W,{value:"profile",className:"w-full",children:[e.jsxs(Z,{className:"grid w-full grid-cols-4",children:[e.jsx(P,{value:"profile",children:"Profile"}),e.jsx(P,{value:"security",children:"Security"}),e.jsx(P,{value:"notifications",children:"Notifications"}),e.jsx(P,{value:"preferences",children:"Preferences"})]}),e.jsx(C,{value:"profile",className:"space-y-6",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Personal Information"]}),e.jsx(w,{children:"Update your personal details and contact information"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:r.avatar?e.jsx("img",{src:r.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(D,{className:"h-8 w-8 text-gray-400"})}),e.jsx("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 bg-blue-600 rounded-full p-1 cursor-pointer hover:bg-blue-700",children:e.jsx(K,{className:"h-3 w-3 text-white"})}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:$,className:"hidden",disabled:_})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Profile Picture"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload a new avatar (max 2MB)"}),_&&e.jsx("p",{className:"text-sm text-blue-600",children:"Uploading..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"firstName",children:"First Name"}),e.jsx(n,{id:"firstName",value:r.firstName,onChange:a=>t(s=>({...s,firstName:a.target.value})),placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"lastName",children:"Last Name"}),e.jsx(n,{id:"lastName",value:r.lastName,onChange:a=>t(s=>({...s,lastName:a.target.value})),placeholder:"Doe"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(n,{id:"username",value:r.username,onChange:a=>t(s=>({...s,username:a.target.value})),placeholder:"johndoe"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(n,{id:"email",type:"email",value:r.email,disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed here. Use security settings."})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Phone"}),e.jsx(n,{id:"phone",value:r.phone,onChange:a=>t(s=>({...s,phone:a.target.value})),placeholder:"+1 (555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"location",children:"Location"}),e.jsx(n,{id:"location",value:r.location,onChange:a=>t(s=>({...s,location:a.target.value})),placeholder:"New York, NY"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"company",children:"Company"}),e.jsx(n,{id:"company",value:r.company,onChange:a=>t(s=>({...s,company:a.target.value})),placeholder:"Acme Corp"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"position",children:"Position"}),e.jsx(n,{id:"position",value:r.position,onChange:a=>t(s=>({...s,position:a.target.value})),placeholder:"Sales Manager"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"website",children:"Website"}),e.jsx(n,{id:"website",value:r.website,onChange:a=>t(s=>({...s,website:a.target.value})),placeholder:"https://example.com"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"bio",children:"Bio"}),e.jsx(le,{id:"bio",value:r.bio,onChange:a=>t(s=>({...s,bio:a.target.value})),placeholder:"Tell us about yourself...",rows:4})]}),e.jsxs(f,{onClick:F,disabled:u,className:"w-full md:w-auto",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),u?"Saving...":"Save Changes"]})]})]})}),e.jsxs(C,{value:"security",className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Password & Security"]}),e.jsx(w,{children:"Manage your password and security settings"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Change Password"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(i,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(n,{id:"currentPassword",type:x.current?"text":"password",value:h.currentPassword,onChange:a=>b(s=>({...s,currentPassword:a.target.value})),placeholder:"Enter current password"}),e.jsx("button",{type:"button",onClick:()=>E(a=>({...a,current:!a.current})),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:x.current?e.jsx(k,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{htmlFor:"newPassword",children:"New Password"}),e.jsx(n,{id:"newPassword",type:x.new?"text":"password",value:h.newPassword,onChange:a=>b(s=>({...s,newPassword:a.target.value})),placeholder:"Enter new password"}),e.jsx("button",{type:"button",onClick:()=>E(a=>({...a,new:!a.new})),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:x.new?e.jsx(k,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(n,{id:"confirmPassword",type:x.confirm?"text":"password",value:h.confirmPassword,onChange:a=>b(s=>({...s,confirmPassword:a.target.value})),placeholder:"Confirm new password"}),e.jsx("button",{type:"button",onClick:()=>E(a=>({...a,confirm:!a.confirm})),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:x.confirm?e.jsx(k,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]})]}),e.jsx(f,{onClick:V,disabled:u||!h.newPassword,children:"Update Password"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Add an extra layer of security to your account"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:r.twoFactorEnabled?e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Enabled"]}):e.jsx(f,{onClick:G,variant:"outline",size:"sm",children:"Enable 2FA"})})]})]})]}),e.jsxs(j,{className:"border-red-200",children:[e.jsxs(g,{children:[e.jsxs(v,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Danger Zone"]}),e.jsx(w,{children:"Irreversible and destructive actions"})]}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between p-4 border border-red-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-red-600",children:"Permanently delete your account and all data"})]}),e.jsxs(f,{onClick:O,variant:"destructive",size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Delete Account"]})]})})]})]}),e.jsx(C,{value:"notifications",className:"space-y-6",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Notification Preferences"]}),e.jsx(w,{children:"Choose how you want to be notified"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive notifications via email"})]}),e.jsx(T,{checked:r.emailNotifications,onCheckedChange:a=>t(s=>({...s,emailNotifications:a}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive browser push notifications"})]}),e.jsx(T,{checked:r.pushNotifications,onCheckedChange:a=>t(s=>({...s,pushNotifications:a}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Marketing Emails"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive promotional emails and updates"})]}),e.jsx(T,{checked:r.marketingEmails,onCheckedChange:a=>t(s=>({...s,marketingEmails:a}))})]})]}),e.jsx(f,{onClick:F,disabled:u,children:"Save Notification Settings"})]})]})}),e.jsx(C,{value:"preferences",className:"space-y-6",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Regional Preferences"]}),e.jsx(w,{children:"Set your language and timezone preferences"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"language",children:"Language"}),e.jsxs(M,{value:r.language,onValueChange:a=>t(s=>({...s,language:a})),children:[e.jsx(B,{children:e.jsx(I,{})}),e.jsxs(R,{children:[e.jsx(o,{value:"en",children:"English"}),e.jsx(o,{value:"es",children:"Spanish"}),e.jsx(o,{value:"fr",children:"French"}),e.jsx(o,{value:"de",children:"German"}),e.jsx(o,{value:"zh",children:"Chinese"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"timezone",children:"Timezone"}),e.jsxs(M,{value:r.timezone,onValueChange:a=>t(s=>({...s,timezone:a})),children:[e.jsx(B,{children:e.jsx(I,{})}),e.jsxs(R,{children:[e.jsx(o,{value:"America/New_York",children:"Eastern Time"}),e.jsx(o,{value:"America/Chicago",children:"Central Time"}),e.jsx(o,{value:"America/Denver",children:"Mountain Time"}),e.jsx(o,{value:"America/Los_Angeles",children:"Pacific Time"}),e.jsx(o,{value:"Europe/London",children:"London"}),e.jsx(o,{value:"Europe/Paris",children:"Paris"}),e.jsx(o,{value:"Asia/Tokyo",children:"Tokyo"})]})]})]})]}),e.jsx(f,{onClick:F,disabled:u,children:"Save Preferences"})]})]})})]})]})}export{he as default};
