import{r,dl as k,j as e,a6 as v,b5 as C,aa as l,ab as i,ac as c,ad as d,cc as S,aj as u,ch as L,bM as E,a as M,ba as B,b as R,C as w,b8 as _}from"./index-e3V0CD7Y.js";import{I as y}from"./input-CBb2iGdE.js";import{L as h}from"./label-D929QgCh.js";import{S as V,a as $,b as O,c as Y,d as p}from"./select-D9Wy1FBy.js";import{C as q}from"./credit-card-DMjJ4PC7.js";function K(){const[s,I]=r.useState([]),[P,A]=r.useState(!0),[j,b]=r.useState(!1),[T,f]=r.useState(!1),{toast:x}=k(),[a,o]=r.useState({userId:"",productType:"monthly",planName:"",planAmount:"",currency:"USD"});r.useEffect(()=>{N()},[]);async function N(){try{const t=await fetch("/api/entitlements/list",{credentials:"include"});if(t.ok){const m=await t.json();I(m.entitlements||[])}else throw new Error("Failed to load entitlements")}catch(t){console.error("Error loading entitlements:",t),x({title:"Error",description:"Failed to load entitlements",variant:"destructive"})}finally{A(!1)}}async function U(){if(!a.userId.trim()||!a.planName.trim()){x({title:"Validation Error",description:"User ID and Plan Name are required",variant:"destructive"});return}b(!0);try{if((await fetch("/api/entitlements/create",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).ok)x({title:"Success",description:"Entitlement created successfully"}),f(!1),o({userId:"",productType:"monthly",planName:"",planAmount:"",currency:"USD"}),await N();else throw new Error("Failed to create entitlement")}catch(t){console.error("Error creating entitlement:",t),x({title:"Error",description:"Failed to create entitlement",variant:"destructive"})}finally{b(!1)}}const D=t=>{const m={active:{variant:"default",icon:R,label:"Active"},past_due:{variant:"secondary",icon:B,label:"Past Due"},canceled:{variant:"outline",icon:M,label:"Canceled"},inactive:{variant:"destructive",icon:E,label:"Inactive"},refunded:{variant:"destructive",icon:L,label:"Refunded"}},n=m[t]||m.inactive,g=n.icon;return e.jsxs(u,{variant:n.variant,className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),n.label]})},F=t=>{if(!t)return e.jsx(u,{variant:"outline",children:"Unknown"});const n={lifetime:{variant:"default",icon:_,label:"Lifetime"},yearly:{variant:"secondary",icon:w,label:"Yearly"},monthly:{variant:"outline",icon:w,label:"Monthly"},payment_plan:{variant:"secondary",icon:q,label:"Payment Plan"}}[t]||{variant:"outline",icon:E,label:t},g=n.icon;return e.jsxs(u,{variant:n.variant,className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),n.label]})};return P?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Entitlements Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage user subscriptions and access control"})]}),e.jsxs(v,{onClick:()=>f(!0),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Create Entitlement"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-gray-600",children:"Total Entitlements"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:s.length})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-gray-600",children:"Active Users"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.filter(t=>t.status==="active").length})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-gray-600",children:"Past Due"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(t=>t.status==="past_due").length})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-gray-600",children:"Lifetime Plans"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.filter(t=>t.productType==="lifetime").length})})]})]}),T&&e.jsxs(l,{className:"mb-6 border-2 border-blue-200",children:[e.jsxs(i,{children:[e.jsx(c,{children:"Create New Entitlement"}),e.jsx(S,{children:"Grant access to a user for SmartCRM features"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"userId",children:"User ID"}),e.jsx(y,{id:"userId",value:a.userId,onChange:t=>o({...a,userId:t.target.value}),placeholder:"Enter Supabase user UUID"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"productType",children:"Product Type"}),e.jsxs(V,{value:a.productType,onValueChange:t=>o({...a,productType:t}),children:[e.jsx($,{children:e.jsx(O,{})}),e.jsxs(Y,{children:[e.jsx(p,{value:"lifetime",children:"Lifetime"}),e.jsx(p,{value:"yearly",children:"Yearly"}),e.jsx(p,{value:"monthly",children:"Monthly"}),e.jsx(p,{value:"payment_plan",children:"Payment Plan"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"planName",children:"Plan Name"}),e.jsx(y,{id:"planName",value:a.planName,onChange:t=>o({...a,planName:t.target.value}),placeholder:"e.g., SmartCRM Pro"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"planAmount",children:"Plan Amount"}),e.jsx(y,{id:"planAmount",type:"number",step:"0.01",value:a.planAmount,onChange:t=>o({...a,planAmount:t.target.value}),placeholder:"29.99"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{variant:"outline",onClick:()=>f(!1),disabled:j,children:"Cancel"}),e.jsx(v,{onClick:U,disabled:j,children:j?"Creating...":"Create Entitlement"})]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"User Entitlements"}),e.jsx(S,{children:s.length===0?"No entitlements found. Create one to get started.":`Showing ${s.length} entitlement${s.length===1?"":"s"}`})]}),e.jsx(d,{children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No entitlements found"})]}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.planName||"Unnamed Plan"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["User: ",t.userId.substring(0,8),"..."]}),t.revokeAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.revokeAt).toLocaleDateString()]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[D(t.status),F(t.productType),t.planAmount&&e.jsxs(u,{variant:"outline",children:["$",t.planAmount," ",t.currency]})]})]},t.id))})})]})]})}export{K as default};
