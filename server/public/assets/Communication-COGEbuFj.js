import{aR as Ne,aS as ve,r as p,j as e,af as ce,ag as re,ah as D,ai as k,aj as v,a6 as j,aI as ee,aT as ye,aU as be,aV as we,a as de,aW as le,P as ne,aa as b,ab as w,ac as C,ad as A,aX as ie,am as B,c as Ce,an as Ae,aY as ae,aM as U,a7 as Se,C as J,ar as V,b as De}from"./index-e3V0CD7Y.js";import{I as L}from"./input-CBb2iGdE.js";import{D as ke,a as Ee,b as Te,c as Ie}from"./dialog-CFFKOlnO.js";import{T as he}from"./textarea-Dn_UEKqi.js";import{S as Re,a as Le,b as Fe,c as Ue,d as Z}from"./select-D9Wy1FBy.js";import{L as T}from"./label-D929QgCh.js";import{P as Me}from"./paperclip-nKH9HzHC.js";const oe=Ne()(ve((d,r)=>({emails:[],templates:[],sequences:[],communicationLogs:[],callLogs:[],analytics:{totalSent:0,totalDelivered:0,totalOpened:0,totalClicked:0,totalReplied:0,deliveryRate:0,openRate:0,clickRate:0,replyRate:0,unsubscribeRate:0,bounceRate:0,spamRate:0,engagementScore:0,bestSendTimes:[],topPerformingSubjects:[],templatePerformance:[]},filter:{status:"all",priority:"all",dateRange:null,contactId:null,dealId:null,tags:[],hasAttachments:null,isTracked:null,searchQuery:""},sendEmail:async s=>{const t={...s,id:crypto.randomUUID(),status:"sent",sentAt:new Date,createdAt:new Date,updatedAt:new Date,trackingPixelId:s.trackingEnabled?crypto.randomUUID():void 0};d(a=>({emails:[...a.emails,t]})),r().logCommunication({type:"email",direction:"outbound",contactId:t.contactId||"",dealId:t.dealId,subject:t.subject,content:t.content,tags:t.tags,attachments:t.attachments.map(a=>a.fileName),createdBy:t.createdBy}),r().updateAnalytics()},saveDraft:s=>{const t={...s,id:crypto.randomUUID(),status:"draft",createdAt:new Date,updatedAt:new Date};d(a=>({emails:[...a.emails,t]}))},scheduleEmail:(s,t)=>{const a={...s,id:crypto.randomUUID(),status:"draft",scheduledAt:t,createdAt:new Date,updatedAt:new Date};d(n=>({emails:[...n.emails,a]}))},updateEmail:(s,t)=>{d(a=>({emails:a.emails.map(n=>n.id===s?{...n,...t,updatedAt:new Date}:n)}))},deleteEmail:s=>{d(t=>({emails:t.emails.filter(a=>a.id!==s)}))},getEmail:s=>r().emails.find(t=>t.id===s),markAsRead:s=>{r().updateEmail(s,{status:"read",readAt:new Date}),r().addEmailTracking(s,"opened")},addEmailTracking:(s,t)=>{const a=r().getEmail(s);if(!a)return;const n=new Date,m={};switch(t){case"opened":a.readAt||(m.readAt=n,m.status="read");break;case"clicked":break;case"replied":m.status="replied";break}r().updateEmail(s,m),r().updateAnalytics()},createTemplate:s=>{const t={...s,id:crypto.randomUUID(),usageCount:0,createdAt:new Date,updatedAt:new Date};d(a=>({templates:[...a.templates,t]}))},updateTemplate:(s,t)=>{d(a=>({templates:a.templates.map(n=>n.id===s?{...n,...t,updatedAt:new Date}:n)}))},deleteTemplate:s=>{d(t=>({templates:t.templates.filter(a=>a.id!==s)}))},useTemplate:(s,t)=>{const a=r().templates.find(N=>N.id===s);if(!a)return{};r().updateTemplate(s,{usageCount:a.usageCount+1});let n=a.content,m=a.subject;return Object.entries(t).forEach(([N,S])=>{const g=`{{${N}}}`;n=n.replace(new RegExp(g,"g"),String(S)),m=m.replace(new RegExp(g,"g"),String(S))}),{subject:m,content:n,htmlContent:a.htmlContent,templateId:s}},duplicateTemplate:s=>{const t=r().templates.find(a=>a.id===s);t&&r().createTemplate({...t,name:`${t.name} (Copy)`,isActive:!1})},createSequence:s=>{const t={...s,id:crypto.randomUUID(),contactCount:0,completionRate:0,createdAt:new Date,updatedAt:new Date};d(a=>({sequences:[...a.sequences,t]}))},updateSequence:(s,t)=>{d(a=>({sequences:a.sequences.map(n=>n.id===s?{...n,...t,updatedAt:new Date}:n)}))},deleteSequence:s=>{d(t=>({sequences:t.sequences.filter(a=>a.id!==s)}))},enrollContactInSequence:(s,t)=>{},logCommunication:s=>{const t={...s,id:crypto.randomUUID(),timestamp:new Date};d(a=>({communicationLogs:[t,...a.communicationLogs]}))},updateCommunicationLog:(s,t)=>{d(a=>({communicationLogs:a.communicationLogs.map(n=>n.id===s?{...n,...t}:n)}))},deleteCommunicationLog:s=>{d(t=>({communicationLogs:t.communicationLogs.filter(a=>a.id!==s)}))},logCall:s=>{const t={...s,id:crypto.randomUUID(),timestamp:new Date};d(a=>({callLogs:[t,...a.callLogs]})),r().logCommunication({type:"call",direction:t.direction,contactId:t.contactId,dealId:t.dealId,content:t.notes,duration:Math.floor(t.duration/60),status:"completed",tags:t.tags,attachments:[],createdBy:t.createdBy})},updateCallLog:(s,t)=>{d(a=>({callLogs:a.callLogs.map(n=>n.id===s?{...n,...t}:n)}))},deleteCallLog:s=>{d(t=>({callLogs:t.callLogs.filter(a=>a.id!==s)}))},generateAISuggestions:async s=>{const t=[{id:crypto.randomUUID(),type:"subject",suggestion:"Add personalization to increase open rates",confidence:.85,reasoning:"Emails with personalized subjects have 26% higher open rates",applied:!1},{id:crypto.randomUUID(),type:"timing",suggestion:"Send on Tuesday at 2 PM for optimal engagement",confidence:.92,reasoning:"Based on recipient's past engagement patterns",applied:!1}];return r().getEmail(s)&&r().updateEmail(s,{aiSuggestions:t}),t},applyAISuggestion:(s,t)=>{const a=r().getEmail(s);if(!a?.aiSuggestions)return;const n=a.aiSuggestions.map(m=>m.id===t?{...m,applied:!0}:m);r().updateEmail(s,{aiSuggestions:n})},updateAnalytics:()=>{const s=r().emails,t=s.filter(g=>g.status!=="draft"),a=s.filter(g=>["delivered","read","replied"].includes(g.status)),n=s.filter(g=>["read","replied"].includes(g.status)),m=s.filter(g=>g.linkTracking.some(I=>I.clickCount>0)),N=s.filter(g=>g.status==="replied"),S={totalSent:t.length,totalDelivered:a.length,totalOpened:n.length,totalClicked:m.length,totalReplied:N.length,deliveryRate:t.length>0?a.length/t.length:0,openRate:a.length>0?n.length/a.length:0,clickRate:n.length>0?m.length/n.length:0,replyRate:n.length>0?N.length/n.length:0,unsubscribeRate:0,bounceRate:0,spamRate:0,engagementScore:0,bestSendTimes:[],topPerformingSubjects:[],templatePerformance:[]};d({analytics:S})},getEmailAnalytics:s=>{let t=r().emails;return s&&(t=t.filter(a=>a.createdAt>=s.start&&a.createdAt<=s.end)),r().analytics},setFilter:s=>{d(t=>({filter:{...t.filter,...s}}))},getFilteredEmails:()=>{const{emails:s,filter:t}=r();let a=s;if(t.status!=="all"&&(a=a.filter(n=>n.status===t.status)),t.priority!=="all"&&(a=a.filter(n=>n.priority===t.priority)),t.contactId&&(a=a.filter(n=>n.contactId===t.contactId)),t.dealId&&(a=a.filter(n=>n.dealId===t.dealId)),t.tags.length>0&&(a=a.filter(n=>t.tags.some(m=>n.tags.includes(m)))),t.hasAttachments!==null&&(a=a.filter(n=>t.hasAttachments?n.attachments.length>0:n.attachments.length===0)),t.isTracked!==null&&(a=a.filter(n=>n.trackingEnabled===t.isTracked)),t.searchQuery){const n=t.searchQuery.toLowerCase();a=a.filter(m=>m.subject.toLowerCase().includes(n)||m.content.toLowerCase().includes(n)||m.fromAddress.toLowerCase().includes(n)||m.toAddresses.some(N=>N.toLowerCase().includes(n)))}return t.dateRange&&(a=a.filter(n=>n.createdAt>=t.dateRange.start&&n.createdAt<=t.dateRange.end)),a},clearFilters:()=>{d({filter:{status:"all",priority:"all",dateRange:null,contactId:null,dealId:null,tags:[],hasAttachments:null,isTracked:null,searchQuery:""}})},getDraftEmails:()=>r().emails.filter(s=>s.status==="draft"),getSentEmails:()=>r().emails.filter(s=>s.status!=="draft"),getScheduledEmails:()=>r().emails.filter(s=>s.scheduledAt&&s.status==="draft"),getEmailsByContact:s=>r().emails.filter(t=>t.contactId===s),getEmailsByDeal:s=>r().emails.filter(t=>t.dealId===s),getCommunicationsByContact:s=>r().communicationLogs.filter(t=>t.contactId===s),getCallsByContact:s=>r().callLogs.filter(t=>t.contactId===s)}),{name:"communication-store",partialize:d=>({emails:d.emails,templates:d.templates,sequences:d.sequences,communicationLogs:d.communicationLogs,callLogs:d.callLogs})}));function Pe({isOpen:d,onClose:r,draft:s,contactId:t,dealId:a,replyToEmail:n}){const{sendEmail:m,saveDraft:N,scheduleEmail:S,templates:g,useTemplate:I,generateAISuggestions:z}=oe(),[u,x]=p.useState({fromAddress:"user@company.com",fromName:"Your Name",toAddresses:[],ccAddresses:[],bccAddresses:[],subject:"",content:"",htmlContent:"",priority:"normal",tags:[],trackingEnabled:!0,scheduledAt:null}),[i,y]=p.useState("compose"),[M,G]=p.useState(!1),[P,K]=p.useState(""),[W,_]=p.useState(""),[se,Y]=p.useState(""),[H,q]=p.useState(""),[me,te]=p.useState(""),[$,X]=p.useState([]),[O,F]=p.useState(!1);p.useEffect(()=>{s&&x({fromAddress:s.fromAddress,fromName:s.fromName||"",toAddresses:s.toAddresses,ccAddresses:s.ccAddresses||[],bccAddresses:s.bccAddresses||[],subject:s.subject,content:s.content,htmlContent:s.htmlContent||"",priority:s.priority,tags:s.tags,trackingEnabled:s.trackingEnabled,scheduledAt:s.scheduledAt||null}),n&&x(l=>({...l,toAddresses:[n.fromAddress],subject:n.subject.startsWith("Re:")?n.subject:`Re: ${n.subject}`,content:`

--- Original Message ---
From: ${n.fromAddress}
Date: ${n.createdAt.toLocaleString()}
Subject: ${n.subject}

${n.content}`}))},[s,n,t]);const o=async()=>{try{await m({...u,contactId:t,dealId:a,attachments:[],linkTracking:[],createdBy:"current-user"}),r()}catch(l){console.error("Failed to send email:",l)}},Q=()=>{N({...u,contactId:t,dealId:a,attachments:[],linkTracking:[],createdBy:"current-user"}),r()},h=()=>{u.scheduledAt&&(S({...u,contactId:t,dealId:a,attachments:[],linkTracking:[],createdBy:"current-user"},u.scheduledAt),r())},R=l=>{const c=I(l,{contactName:"Contact Name",companyName:"Company Name"});x(f=>({...f,...c}))},je=async()=>{F(!0);try{X([{type:"subject",suggestion:"Personalize subject line with recipient name",action:()=>x(c=>({...c,subject:`Hi [Name], ${c.subject}`}))},{type:"content",suggestion:"Add a clear call-to-action",action:()=>x(c=>({...c,content:c.content+`

Would you like to schedule a quick 15-minute call to discuss this further?`}))},{type:"timing",suggestion:"Send on Tuesday at 2 PM for better engagement",action:()=>{const c=new Date;c.setDate(c.getDate()+(2-c.getDay()+7)%7),c.setHours(14,0,0,0),x(f=>({...f,scheduledAt:c}))}}])}finally{F(!1)}},xe=(l,c)=>{if(c&&c.includes("@")){const f=`${l}Addresses`;x(E=>({...E,[f]:[...E[f],c]})),l==="to"&&K(""),l==="cc"&&_(""),l==="bcc"&&Y("")}},ue=(l,c)=>{const f=`${l}Addresses`;x(E=>({...E,[f]:E[f].filter((ze,fe)=>fe!==c)}))},ge=l=>{l&&!u.tags.includes(l)&&(x(c=>({...c,tags:[...c.tags,l]})),q(""))},pe=l=>{x(c=>({...c,tags:c.tags.filter((f,E)=>E!==l)}))};return e.jsx(ke,{open:d,onOpenChange:r,children:e.jsxs(Ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Te,{children:e.jsx(Ie,{children:s?"Edit Draft":n?"Reply":"Compose Email"})}),e.jsxs(ce,{value:i,onValueChange:y,children:[e.jsxs(re,{children:[e.jsx(D,{value:"compose",children:"Compose"}),e.jsx(D,{value:"templates",children:"Templates"}),e.jsx(D,{value:"ai",children:"AI Assistant"}),e.jsx(D,{value:"schedule",children:"Schedule"})]}),e.jsxs(k,{value:"compose",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"fromAddress",children:"From Email"}),e.jsx(L,{id:"fromAddress",value:u.fromAddress,onChange:l=>x(c=>({...c,fromAddress:l.target.value}))})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"fromName",children:"From Name"}),e.jsx(L,{id:"fromName",value:u.fromName,onChange:l=>x(c=>({...c,fromName:l.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"to",children:"To"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:u.toAddresses.map((l,c)=>e.jsxs(v,{variant:"secondary",children:[l,e.jsx("button",{onClick:()=>ue("to",c),className:"ml-1 text-xs",children:"×"})]},c))}),e.jsx(L,{id:"to",placeholder:"Enter email address and press Enter",value:P,onChange:l=>K(l.target.value),onKeyPress:l=>{l.key==="Enter"&&(l.preventDefault(),xe("to",P))}})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"cc",children:"CC"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:u.ccAddresses.map((l,c)=>e.jsxs(v,{variant:"secondary",children:[l,e.jsx("button",{onClick:()=>ue("cc",c),className:"ml-1 text-xs",children:"×"})]},c))}),e.jsx(L,{id:"cc",placeholder:"Enter CC email address",value:W,onChange:l=>_(l.target.value),onKeyPress:l=>{l.key==="Enter"&&(l.preventDefault(),xe("cc",W))}})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"subject",children:"Subject"}),e.jsx(L,{id:"subject",value:u.subject,onChange:l=>x(c=>({...c,subject:l.target.value})),placeholder:"Email subject"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"priority",children:"Priority"}),e.jsxs(Re,{value:u.priority,onValueChange:l=>x(c=>({...c,priority:l})),children:[e.jsx(Le,{children:e.jsx(Fe,{})}),e.jsxs(Ue,{children:[e.jsx(Z,{value:"low",children:"Low"}),e.jsx(Z,{value:"normal",children:"Normal"}),e.jsx(Z,{value:"high",children:"High"}),e.jsx(Z,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(T,{htmlFor:"content",children:"Content"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:()=>G(!M),children:[M?e.jsx(ee,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"}),M?"Visual":"HTML"]})})]}),M?e.jsx(he,{id:"htmlContent",value:u.htmlContent,onChange:l=>x(c=>({...c,htmlContent:l.target.value})),placeholder:"HTML content",rows:12,className:"font-mono text-sm"}):e.jsx(he,{id:"content",value:u.content,onChange:l=>x(c=>({...c,content:l.target.value})),placeholder:"Email content",rows:12})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"tags",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:u.tags.map((l,c)=>e.jsxs(v,{variant:"outline",children:[l,e.jsx("button",{onClick:()=>pe(c),className:"ml-1 text-xs",children:"×"})]},c))}),e.jsx(L,{id:"tags",placeholder:"Add tags",value:H,onChange:l=>q(l.target.value),onKeyPress:l=>{l.key==="Enter"&&(l.preventDefault(),ge(H))}})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.trackingEnabled,onChange:l=>x(c=>({...c,trackingEnabled:l.target.checked}))}),"Enable tracking"]})})]}),e.jsx(k,{value:"templates",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[g.filter(l=>l.isActive).map(l=>e.jsxs("div",{className:"p-4 border rounded-lg cursor-pointer hover:bg-gray-50",onClick:()=>R(l.id),children:[e.jsx("h3",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600",children:l.subject}),e.jsx(v,{variant:"outline",className:"mt-2",children:l.category})]},l.id)),g.filter(l=>l.isActive).length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No active templates found"})]})}),e.jsxs(k,{value:"ai",className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs(j,{onClick:je,disabled:O,className:"mb-4",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),O?"Generating...":"Get AI Suggestions"]})}),$.length>0&&e.jsx("div",{className:"space-y-3",children:$.map((l,c)=>e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(v,{variant:"outline",className:"mb-2",children:l.type}),e.jsx("p",{className:"text-sm",children:l.suggestion})]}),e.jsx(j,{size:"sm",onClick:l.action,variant:"outline",children:"Apply"})]})},c))})]}),e.jsxs(k,{value:"schedule",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"scheduledAt",children:"Schedule for later"}),e.jsx(L,{id:"scheduledAt",type:"datetime-local",value:u.scheduledAt?u.scheduledAt.toISOString().slice(0,16):"",onChange:l=>x(c=>({...c,scheduledAt:l.target.value?new Date(l.target.value):null}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Quick Schedule"}),e.jsx("div",{className:"space-y-2",children:[{label:"In 1 hour",hours:1},{label:"Tomorrow 9 AM",hours:24,setHour:9},{label:"Next Monday 9 AM",days:7,setHour:9}].map((l,c)=>e.jsx(j,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{const f=new Date;l.days?f.setDate(f.getDate()+l.days):l.hours&&f.setHours(f.getHours()+l.hours),l.setHour!==void 0&&f.setHours(l.setHour,0,0,0),x(E=>({...E,scheduledAt:f}))},children:l.label},c))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Best Send Times"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("p",{children:"• Tuesday-Thursday: 2-4 PM"}),e.jsx("p",{children:"• Avoid Mondays and Fridays"}),e.jsx("p",{children:"• Based on recipient's timezone"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Attach"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(j,{variant:"outline",onClick:Q,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Save Draft"]}),u.scheduledAt?e.jsxs(j,{onClick:h,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Schedule"]}):e.jsxs(j,{onClick:o,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Send"]})]})]})]})})}function Be(){const{emails:d,templates:r,analytics:s,filter:t,getFilteredEmails:a,getDraftEmails:n,getSentEmails:m,getScheduledEmails:N,setFilter:S,clearFilters:g,markAsRead:I,deleteEmail:z}=oe(),[u,x]=p.useState(!1),[i,y]=p.useState(null),[M,G]=p.useState(null),[P,K]=p.useState(""),[W,_]=p.useState("inbox"),se=a(),Y=n(),H=m(),q=N();p.useEffect(()=>{S({searchQuery:P})},[P,S]);const me=o=>{y(o),o.status!=="read"&&o.status!=="replied"&&I(o.id)},te=o=>{G(o),x(!0)},$=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=o=>{switch(o){case"draft":return e.jsx(de,{className:"w-4 h-4 text-gray-500"});case"sent":return e.jsx(le,{className:"w-4 h-4 text-blue-500"});case"delivered":return e.jsx(U,{className:"w-4 h-4 text-green-500"});case"read":return e.jsx(ee,{className:"w-4 h-4 text-purple-500"});case"replied":return e.jsx(ae,{className:"w-4 h-4 text-indigo-500"});case"failed":return e.jsx(U,{className:"w-4 h-4 text-red-500"});default:return e.jsx(U,{className:"w-4 h-4 text-gray-500"})}},O=o=>{switch(o){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-gray-100 text-gray-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},F=({emails:o,title:Q})=>e.jsx("div",{className:"space-y-2",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{children:["No ",Q.toLowerCase()," found"]})]}):o.map(h=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors ${i?.id===h.id?"bg-blue-50 border-blue-200":""} ${h.status==="read"||h.status==="replied"?"":"font-medium"}`,onClick:()=>me(h),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[X(h.status),e.jsx("span",{className:"text-sm text-gray-600",children:h.fromAddress}),e.jsx(v,{variant:"secondary",className:O(h.priority),children:h.priority}),h.tags.map(R=>e.jsx(v,{variant:"outline",className:"text-xs",children:R},R))]}),e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:h.subject}),e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:h.content}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:$(h.createdAt)}),h.attachments.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:["📎 ",h.attachments.length]}),h.trackingEnabled&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Tracked"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:R=>{R.stopPropagation(),te(h)},children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:R=>{R.stopPropagation()},children:e.jsx(Se,{className:"w-4 h-4"})})]})]})},h.id))});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Email"}),e.jsx("p",{className:"text-gray-600",children:"Manage your email communications"})]}),e.jsxs(j,{onClick:()=>x(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Compose"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Sent"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.totalSent}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.deliveryRate>0&&e.jsxs("span",{className:"text-green-600",children:[(s.deliveryRate*100).toFixed(1),"% delivery rate"]})})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Open Rate"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(s.openRate*100).toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalOpened," emails opened"]})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Click Rate"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(s.clickRate*100).toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalClicked," emails clicked"]})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Reply Rate"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(s.replyRate*100).toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalReplied," emails replied"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(b,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{children:"Emails"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(L,{placeholder:"Search emails...",value:P,onChange:o=>K(o.target.value),className:"pl-10 w-64"})]}),e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Filter"]})]})]})}),e.jsx(A,{children:e.jsxs(ce,{value:W,onValueChange:_,children:[e.jsxs(re,{className:"mb-4",children:[e.jsxs(D,{value:"inbox",children:["Inbox (",se.length,")"]}),e.jsxs(D,{value:"sent",children:["Sent (",H.length,")"]}),e.jsxs(D,{value:"drafts",children:["Drafts (",Y.length,")"]}),e.jsxs(D,{value:"scheduled",children:["Scheduled (",q.length,")"]})]}),e.jsx(k,{value:"inbox",children:e.jsx(F,{emails:se,title:"Inbox"})}),e.jsx(k,{value:"sent",children:e.jsx(F,{emails:H,title:"Sent"})}),e.jsx(k,{value:"drafts",children:e.jsx(F,{emails:Y,title:"Drafts"})}),e.jsx(k,{value:"scheduled",children:e.jsx(F,{emails:q,title:"Scheduled"})})]})})]})}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs(b,{children:[e.jsx(w,{children:e.jsx(C,{children:"Email Preview"})}),e.jsx(A,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[X(i.status),e.jsx(v,{className:O(i.priority),children:i.priority})]}),e.jsx("h3",{className:"font-medium text-lg",children:i.subject}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("p",{children:["From: ",i.fromAddress]}),e.jsxs("p",{children:["To: ",i.toAddresses.join(", ")]}),e.jsxs("p",{children:["Date: ",$(i.createdAt)]})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:i.htmlContent?e.jsx("div",{dangerouslySetInnerHTML:{__html:i.htmlContent}}):e.jsx("p",{className:"whitespace-pre-wrap",children:i.content})})}),i.attachments.length>0&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Attachments"}),e.jsx("div",{className:"space-y-2",children:i.attachments.map(o=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["📎 ",o.fileName,e.jsxs("span",{className:"text-gray-500",children:["(",(o.fileSize/1024).toFixed(1)," KB)"]})]},o.id))})]}),i.tags.length>0&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.map(o=>e.jsx(v,{variant:"outline",children:o},o))})]}),e.jsxs("div",{className:"border-t pt-4 flex gap-2",children:[e.jsxs(j,{size:"sm",onClick:()=>te(i),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Reply"]}),e.jsx(j,{variant:"outline",size:"sm",children:"Forward"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>z(i.id),children:"Delete"})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select an email to preview"})]})})]}),e.jsxs(b,{className:"mt-6",children:[e.jsx(w,{children:e.jsx(C,{children:"Quick Stats"})}),e.jsxs(A,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Templates"}),e.jsx("span",{className:"font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Unread"}),e.jsx("span",{className:"font-medium",children:d.filter(o=>o.status!=="read"&&o.status!=="replied").length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Today's Emails"}),e.jsx("span",{className:"font-medium",children:d.filter(o=>{const Q=new Date;return new Date(o.createdAt).toDateString()===Q.toDateString()}).length})]})]})]})]})]}),e.jsx(Pe,{isOpen:u,onClose:()=>{x(!1),G(null)},replyToEmail:M||void 0})]})})}function Ke(){const{emails:d,callLogs:r,communicationLogs:s,analytics:t}=oe(),[a,n]=p.useState("email"),m=s.slice(0,10).sort((i,y)=>new Date(y.timestamp).getTime()-new Date(i.timestamp).getTime()),N=r.slice(0,5).sort((i,y)=>new Date(y.timestamp).getTime()-new Date(i.timestamp).getTime()),S=i=>new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=i=>{switch(i){case"email":return e.jsx(U,{className:"w-4 h-4"});case"call":return e.jsx(V,{className:"w-4 h-4"});case"meeting":return e.jsx(J,{className:"w-4 h-4"});case"text":return e.jsx(B,{className:"w-4 h-4"});default:return e.jsx(B,{className:"w-4 h-4"})}},I=i=>{switch(i){case"completed":return"bg-green-100 text-green-800";case"scheduled":return"bg-blue-100 text-blue-800";case"missed":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},z=()=>e.jsxs(b,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Recent Calls"]}),e.jsxs(j,{size:"sm",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Log Call"]})]})}),e.jsx(A,{children:N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No calls logged yet"})]}):e.jsx("div",{className:"space-y-4",children:N.map(i=>e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${i.direction==="outbound"?"bg-blue-100":"bg-green-100"}`,children:e.jsx(V,{className:`w-4 h-4 ${i.direction==="outbound"?"text-blue-600":"text-green-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:i.phoneNumber}),e.jsx(v,{className:I(i.status),children:i.status}),e.jsx(v,{variant:"outline",children:i.direction})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Duration: ",Math.floor(i.duration/60),"m ",i.duration%60,"s"]}),i.notes&&e.jsx("p",{className:"text-sm text-gray-700 truncate",children:i.notes}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:S(i.timestamp)}),i.outcome&&e.jsx(v,{variant:"outline",className:"text-xs",children:i.outcome})]})]})]},i.id))})})]}),u=()=>e.jsxs(b,{children:[e.jsx(w,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Communication Timeline"]})}),e.jsx(A,{children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(B,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No communications logged yet"})]}):e.jsx("div",{className:"space-y-4",children:m.map(i=>e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${i.direction==="outbound"?"bg-blue-100":"bg-green-100"}`,children:g(i.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium capitalize",children:i.type}),e.jsx(v,{className:I(i.status),children:i.status}),e.jsx(v,{variant:"outline",children:i.direction})]}),i.subject&&e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:i.subject}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:i.content}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:S(i.timestamp)}),i.duration&&e.jsxs("span",{children:[i.duration," min"]}),i.tags.map(y=>e.jsx(v,{variant:"outline",className:"text-xs",children:y},y))]})]})]},i.id))})})]}),x=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Communications"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.length+r.length+s.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all channels"})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"This Week"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.filter(i=>{const y=new Date;return y.setDate(y.getDate()-7),new Date(i.timestamp)>y}).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Communications this week"})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Response Rate"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(t.replyRate*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email response rate"})]})]}),e.jsxs(b,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Avg Response Time"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2.3h"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average response time"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(u,{}),e.jsx(z,{})]})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Communications"}),e.jsx("p",{className:"text-gray-600",children:"Manage all your customer communications"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Schedule Meeting"]}),e.jsxs(j,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"New Communication"]})]})]}),e.jsxs(ce,{value:a,onValueChange:n,children:[e.jsxs(re,{className:"mb-6",children:[e.jsxs(D,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(D,{value:"email",className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Email (",d.length,")"]}),e.jsxs(D,{value:"calls",className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Calls (",r.length,")"]}),e.jsxs(D,{value:"meetings",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Meetings"]})]}),e.jsx(k,{value:"overview",children:e.jsx(x,{})}),e.jsx(k,{value:"email",children:e.jsx("div",{"data-testid":"video-email",children:e.jsx(Be,{})})}),e.jsx(k,{value:"calls",children:e.jsx("div",{"data-testid":"voip-dialer",children:e.jsx(z,{})})}),e.jsx(k,{value:"meetings",children:e.jsxs(b,{children:[e.jsx(w,{children:e.jsx(C,{children:"Meetings"})}),e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Meeting management coming soon"})]})})]})})]})]})})}export{Ke as default};
